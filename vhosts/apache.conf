<VirtualHost *:80>
    ServerName advanced.local
    DocumentRoot /path/to/advanced

    #ErrorLog /var/log/apache2/advanced.local.error.log
    #CustomLog /var/log/apache2/advanced.local.access.log combined
    AddDefaultCharset UTF-8
    DirectoryIndex index.php
    Options FollowSymLinks
    RewriteEngine on

    # the main rewrite rule for the frontend application
    RewriteCond %{REQUEST_URI} (?!^/((frontend|backend)/web|admin))^
    RewriteRule ^ /frontend/web%{REQUEST_URI} [L]

    <Directory /path/to/advanced/frontend/web/>
        AllowOverride none
        <IfVersion < 2.4>
          Order allow,deny
          Allow from all
        </IfVersion>
        <IfVersion >= 2.4>
          Require all granted
        </IfVersion>

        # if a directory or a file exists, use the request directly
        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteCond %{REQUEST_FILENAME} !-d
        # otherwise forward the request to index.php
        RewriteRule ^ index.php [L]
    </Directory>

    # redirect a trailing slash (uncomment if necessary)
    #RedirectMatch 301 ^/admin/$ /admin
    # allow the access to the backend folder without a trailing slash
    RewriteCond %{REQUEST_URI} ^/admin$
    RewriteRule ^ /backend/web/index.php [L]
    # the main rewrite rule for the backend application
    RewriteCond %{REQUEST_URI} (?!^/backend/web)^/admin
    RewriteRule ^/admin/?(.*) /backend/web/$1 [L]

    <Directory /path/to/advanced/backend/web/>
        AllowOverride none
        <IfVersion < 2.4>
            Order allow,deny
            Allow from all
        </IfVersion>
        <IfVersion >= 2.4>
            Require all granted
        </IfVersion>

        # if a directory or a file exists, use the request directly
        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteCond %{REQUEST_FILENAME} !-d
        # otherwise forward the request to index.php
        RewriteRule ^ index.php [L]
    </Directory>

    <FilesMatch /\.git>
        <IfVersion < 2.4>
            Deny from all
        </IfVersion>
        <IfVersion >= 2.4>
            Require all denied
        </IfVersion>
    </FilesMatch>
</VirtualHost>
